/**
 * sofa-user-service - v0.2.0 - 2014-05-28
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO).
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(a){"use strict";a.define("sofa.UserService",function(b,c,d,e){var f={},g={"Content-Type":"application/x-www-form-urlencoded"},h="basketService_",i=h+"invoiceAddress",j=h+"shippingAddress",k=h+"loggedInUser",l=c.get("apiEndpoint")+"customers/login",m=c.get("storeCode"),n=null;return f.getInvoiceAddress=function(){var a=b.get(i);return a||(a={country:c.getDefaultCountry()},f.updateInvoiceAddress(a)),a},f.updateInvoiceAddress=function(a){return b.set(i,a)},f.getShippingAddress=function(){var a=b.get(j);return a||(a={country:c.getDefaultCountry()},f.updateInvoiceAddress(a)),a},f.updateShippingAddress=function(a){return b.set(j,a)},f.login=function(c,h){var i=e.defer();return d({method:"POST",url:l,headers:g,transformRequest:a.Util.toFormData,data:{storeCode:m,user:c,password:h}}).then(function(a){n=a.data,b.set(k,n),i.resolve(n)},function(){f.logout(),i.reject()}),i.promise},f.isLoggedIn=function(){return n||(n=b.get(k)),!!n},f.logout=function(){b.remove(k),n=null},f.getEmail=function(){if(!f.isLoggedIn())throw new Error("Can't access email address, user is not logged in!");var a=n||b.get(k);return a.customer.email},f.getAddresses=function(){if(!f.isLoggedIn())throw new Error("Can't access addresses, user is not logged in!");var a=n||b.get(k);return a.customer.addresses},f})}(sofa);