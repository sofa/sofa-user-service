/**
 * sofa-user-service - v0.4.0 - 2014-11-20
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO).
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(a){"use strict";a.define("sofa.UserService",function(b,c,d,e){var f={},g={"Content-Type":"application/x-www-form-urlencoded"},h="billingAddress",i="shippingAddress",j="loggedInUser",k=c.get("apiEndpoint")+"customers/login",l=c.get("storeCode"),m=null;return f.getBillingAddress=function(){return b.get(h)},f.updateBillingAddress=function(a){return b.set(h,a)},f.hasExistingAddress=function(a){return!!b.get(a)},f.hasExistingShippingAddress=function(){return f.hasExistingAddress(i)},f.hasExistingBillingAddress=function(){return f.hasExistingAddress(h)},f.getShippingAddress=function(){return b.get(i)},f.updateShippingAddress=function(a){return b.set(i,a)},f.login=function(c,h){var i=e.defer();return d({method:"POST",url:k,headers:g,transformRequest:a.Util.toFormData,data:{storeCode:l,user:c,password:h}}).then(function(a){m=a.data,b.set(j,m),i.resolve(m)},function(){f.logout(),i.reject()}),i.promise},f.isLoggedIn=function(){return m||(m=b.get(j)),!!m},f.logout=function(){b.remove(j),m=null},f.getEmail=function(){if(!f.isLoggedIn())throw new Error("Can't access email address, user is not logged in!");var a=m||b.get(j);return a.customer.email},f.getAddresses=function(){if(!f.isLoggedIn())throw new Error("Can't access addresses, user is not logged in!");var a=m||b.get(j);return a.customer.addresses},f})}(sofa);